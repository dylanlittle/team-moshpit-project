<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="spotifyTopArtistsBox">

    <div class="box">
        <h3>Top Artists</h3>

        <div th:if="${user.spotifyRefreshToken == null}">
            <p>Connect Spotify to see your top artists.</p>
        </div>

        <div th:if="${user.spotifyRefreshToken != null}">

            <div style="margin-bottom: 10px;">
                <label for="timeRange" style="display:block; margin-bottom:4px;">Time range</label>
                <select id="timeRange" name="timeRange" data-ajax-timerange>
                    <option value="short_term" th:selected="${timeRange == 'short_term'}">Last 4 weeks</option>
                    <option value="medium_term" th:selected="${timeRange == 'medium_term'}">Last 6 months</option>
                    <option value="long_term" th:selected="${timeRange == 'long_term'}">All time-ish</option>
                </select>
            </div>

            <p th:if="${spotifyTopArtists == null or #lists.isEmpty(spotifyTopArtists)}">
                No top artists found yet.
            </p>

            <ul th:if="${spotifyTopArtists != null and !#lists.isEmpty(spotifyTopArtists)}">
                <li th:each="a : ${spotifyTopArtists}">
                    <div style="display:flex; gap:10px; align-items:center;">
                        <img th:if="${a.images != null and !#lists.isEmpty(a.images)}"
                             th:src="${a.images.get(0).url}"
                             style="width:40px; height:40px; border-radius:8px; object-fit:cover;" />

                        <div style="display:flex; flex-direction:column;">
                            <span th:text="${a.name}">Artist</span>

                            <a th:if="${spotifySuggestions != null and spotifySuggestions.containsKey(a.id)}"
                               th:href="@{/artists/{id}(id=${spotifySuggestions.get(a.id).id})}">
                                View on Mosh Pit
                            </a>

                            <span th:unless="${spotifySuggestions != null and spotifySuggestions.containsKey(a.id)}"
                                  style="opacity:0.7; font-size:0.9em;">
                                Not on Mosh Pit yet
                            </span>
                        </div>
                    </div>
                </li>
            </ul>

        </div>
    </div>

</div>
</body>
</html>
