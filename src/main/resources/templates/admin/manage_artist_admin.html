<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <title>Add artist admin</title>

    <link rel="stylesheet" href="/main.css">
    <link rel="stylesheet" href="/navbar.css"/>
    <link rel="stylesheet" href="/theme.css"/>
    <link rel="stylesheet" href="/search-results.css"/>
</head>

<body>
<header class="page-header">
    <div th:insert="~{fragments/navbar :: headerNav}"></div>
</header>

<main class="search-container">

    <!-- Success / error messages -->
    <div th:if="${success}" class="alert alert-success">
        <strong>✓</strong> <span th:text="${success}"></span>
    </div>
    <div th:if="${error}" class="alert alert-danger">
        <strong>✗</strong> <span th:text="${error}"></span>
    </div>

    <h2>Manage artist admins</h2>

    <!-- Search form -->
    <form th:action="@{/artists/{id}/newAdmin(id=${id})}"
          method="get"
          class="search-form">

        <div>
            <label for="query">Search term:</label>
            <input type="text"
                   id="query"
                   name="query"
                   placeholder="Enter name or username"
                   th:value="${query}"
                   required />
        </div>

        <div>
            <button type="submit" class="btn">
                Search
            </button>
        </div>
    </form>

    <!-- Search results -->
    <section class="search-section">

        <div th:if="${#lists.isEmpty(userResults)}">
            No users found.
        </div>

        <ol class="results-list">
            <li th:each="user : ${userResults}">
                <div style="cursor: pointer;"
                     onclick="this.querySelector('form').submit()">

                    <div
                            th:replace="~{fragments/display-card ::
                        displayCard(
                            ${user.username},
                            '',
                            ${user.avatar} ?: 'https://placehold.co/128',
                            'Picture of user'
                        )}">
                    </div>

                    <form
                          th:action="@{/artists/{id}/newAdmin(id=${id})}"
                          method="post"
                          style="display: flex; justify-content: center; margin-top: 8px;">

                        <input type="hidden" name="userId" th:value="${user.id}">
                        <input type="hidden" name="query" th:value="${query}">

                        <button type="submit" class="btn btn-sm">
                            Add Admin
                        </button>
                    </form>

                    <form th:action="@{/artists/{id}/newAdmin(id=${id})}"
                          method="post"
                          style="display: none;">
                        <input type="hidden"
                               name="userId"
                               th:value="${user.id}">
                    </form>

                </div>
            </li>
        </ol>

    </section>

    <!-- Existing admins -->
    <section class="search-section">

        <h2>Existing admins</h2>

        <ol class="results-list">
            <li th:each="admin : ${admins}">
                <div style="position: relative;">

                    <div
                            th:replace="~{fragments/display-card ::
                        displayCard(
                            ${admin.user.name},
                            '/users/' + ${admin.user.id},
                            ${admin.user.avatar} ?: 'https://placehold.co/128',
                            'Picture of admin'
                        )}">
                    </div>

                    <form th:if="${admin.role.toString() == 'ADMIN'}"
                          th:action="@{/artists/{artistId}/admin/{adminId}(artistId=${id}, adminId=${admin.id})}"
                          method="post"
                          class="remove-admin-form"
                          style="position: absolute; top: 6px; right: 6px;">
                        <input type="hidden" name="_method" value="DELETE"/>
                        <button type="submit"
                                class="btn btn-danger btn-sm"
                                th:attr="onclick=|return confirm('Remove ${admin.user.name} as admin?')|"
                                title="Remove admin">
                            ×
                        </button>
                    </form>

                </div>
            </li>
        </ol>

    </section>

    <!-- Back link -->
    <div style="margin-top: 32px; text-align: center;">
        <a th:href="@{/artists/{id}(id=${id})}" class="btn">
            ← Back to Artist Page
        </a>
    </div>

</main>

</body>
</html>