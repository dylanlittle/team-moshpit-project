<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Add New Concert Date</title>
    <link rel="stylesheet" href="/main.css" />
    <link rel="stylesheet" href="/navbar.css"/>
    <link rel="stylesheet" href="/create-concert.css"/>
    <th:block th:replace="~{fragments/timezone-script :: timezone-detector}"></th:block>
</head>

<body>
<header class="page-header">
    <div th:insert="~{fragments/navbar :: headerNav}"></div>
</header>

<form th:action="@{/concerts/{id}/lineup(id=${concert.id})}"
      th:object="${lineupForm}"
      method="post"
      id="lineupForm">

    <h3>Add lineup</h3>

    <div id="artistContainer">
        <!-- Initial artist select -->
        <div class="artist-select">
            <select th:field="*{artistIds}" class="artist-select-input">
                <option value="" disabled selected>Select an artist</option>
                <option th:each="artist : ${artists}"
                        th:value="${artist.id}"
                        th:text="${artist.name}"></option>
            </select>
        </div>
    </div>

    <button type="button" id="addArtistBtn">Add another artist</button>
    <button type="submit" id="submitLineupBtn">Skip</button>

</form>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const submitBtn = document.getElementById("submitLineupBtn");
        const addBtn = document.getElementById("addArtistBtn");
        const container = document.getElementById("artistContainer");

        const getFirstSelect = () => container.querySelector("select");

        function updateButtons() {
            const hasSelection = Boolean(getFirstSelect().value);

            // Update submit button text
            submitBtn.textContent = hasSelection
                ? "Submit Lineup"
                : "Skip";

            // Show/hide "Add another artist"
            addBtn.style.display = hasSelection ? "inline-block" : "none";
        }

        // Initial state
        updateButtons();

        // Listen for changes on any select
        container.addEventListener("change", updateButtons);

        // Add artist functionality
        const template = container.querySelector(".artist-select").outerHTML;

        addBtn.addEventListener("click", () => {
            container.insertAdjacentHTML("beforeend", template);
        });
    });
</script>
</body>
</html>