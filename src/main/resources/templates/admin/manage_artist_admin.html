<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <title>
        Add artist admin
    </title>
    <link rel="stylesheet" href="/main.css">
    <link rel="stylesheet" href="/navbar.css" />
</head>

<body>
    <header class="page-header">
        <div th:insert="~{fragments/navbar :: headerNav}"></div>
        <div th:if="${success}" class="alert alert-success" style="margin: 16px 0; padding: 12px; background: #d1fae5; border: 1px solid #a7f3d0;">
            <strong>✓</strong> <span th:text="${success}"></span>
        </div>
        <div th:if="${error}" class="alert alert-danger" style="margin: 16px 0; padding: 12px; background: #fee2e2; border: 1px solid #fca5a5;">
            <strong>✗</strong> <span th:text="${error}"></span>
        </div>

        <h1>Manage artist admins</h1>
    </header>
    <main>
        <form th:action="@{/artists/{id}/newAdmin(id=${id})}" method="get"
            style="display: flex; gap: 16px; border-bottom: solid; margin-bottom: 24px; padding-bottom: 8px;">
            <div>
                <label for="query">Search term:</label>
                <input type="text" id="query" name="query" placeholder="Enter name or username" th:value="${query}"
                    required />
            </div>
            <div>
                <button type="submit" style="margin: 0 0 0 8px;">Search</button>
            </div>
        </form>

        <section>
            <div th:if="${#lists.isEmpty(userResults)}">
                No users found.
            </div>

            <ol style="display: flex;">
                <li th:each="user: ${userResults}">
                    <div style="display: flex; flex-direction: column; margin: 8px; cursor: pointer;"
                        onclick="this.querySelector('form').submit()">

                        <img height="128" width="128" th:src="${user.avatar} ?: '/uploads/default_profile.png'" alt="Picture of user">
                        <div style="margin-top: 8px" th:text="${user.username}"></div>

                        <form th:action="@{/artists/{id}/newAdmin(id=${id})}" method="post" style="display: none;">
                            <input type="hidden" name="userId" th:value="${user.id}">
                        </form>
                    </div>
                </li>
            </ol>
        </section>
        <section>
            <h2>Existing admins</h2>
            <ul style="display: flex; margin: 12px 0;">
                <li th:each="admin : ${admins}">
                    <div style="position: relative;">
                    <div
                        th:replace="~{fragments/display-card :: displayCard(${admin.user.name}, '/users/' + ${admin.user.id}, ${admin.user.avatar} ?: 'https://placehold.co/128', 'Picture of admin')}">
                    </div>
                    <form th:if="${admin.role.toString() == 'ADMIN'}"
                          th:action="@{/artists/{artistId}/admin/{adminId}(artistId=${id}, adminId=${admin.id})}"
                          method="post"
                          style="position: absolute; top: 5px; right: 5px; margin: 0;"
                          class="remove-admin-form">
                        <input type="hidden" name="_method" value="DELETE"/>
                        <button type="submit"
                                th:attr="onclick=|return confirm('Remove ${admin.user.name} as admin?')|" class="btn btn-sm btn-danger"
                                style="font-size: 10px; padding: 2px 6px;"
                                title="Remove admin">×</button>
                    </form>
                    </div>
                </li>
            </ul>
        </section>
        <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee; text-align: center;">
            <a th:href="@{/artists/{id}(id=${id})}" class="btn btn-outline-secondary" style="font-weight: 500;">
                ← Back to Artist Page
            </a>
        </div>
    </main>
</body>

</html>